!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.locizeEditor=t()}(this,function(){"use strict";function e(e){return null!=e&&e===e.window}function t(t){return e(t)?t:9===t.nodeType&&t.defaultView}function n(e){var n,o,i={top:0,left:0,right:0,bottom:0},r=e&&e.ownerDocument;n=r.documentElement,"undefined"!==d(e.getBoundingClientRect)&&(i=e.getBoundingClientRect()),o=t(r);var l=i.top+o.pageYOffset-n.clientTop,s=i.left+o.pageXOffset-n.clientLeft;return{top:l,left:s,right:s+(i.right-i.left),bottom:l+(i.bottom-i.top)}}function o(e){var t=void 0,o=void 0;if(e.originalEvent&&e.originalEvent.explicitOriginalTarget)t=e.originalEvent.explicitOriginalTarget;else{var i=e.srcElement;if(i.getAttribute&&""===i.getAttribute("ignorelocizeeditor"))return null;for(var r=e.pageX,l=e.pageY,s=(n(i),0),a=void 0,d=0;d<i.childNodes.length;d++){var c=i.childNodes[d],p=n(c);1===c.nodeType&&p.bottom<l&&(s=d+1),!a&&p.top+(c.clientHeight||0)>l&&(a=d)}s+1>i.childNodes.length&&(s=i.childNodes.length-1),a||(a=i.childNodes.length);for(var u=s;u<a;u++){var f=i.childNodes[u],g=n(f);if(!o&&g.left>r)break;8!==f.nodeType&&(t=f)}}return t}function i(e,t){var n=e,o=t.options.nsSeparator;if(e.indexOf(o)>-1){var i=e.split(o);i.shift(),n=i.join(o)}return n}function r(e,t,n){var o=n.options.defaultNS,i=n.options.nsSeparator;if(e.indexOf(i)>-1)o=e.split(i)[0];else{var r=void 0,l=function e(t){var n=t.getAttribute&&t.getAttribute("i18next-options");if(n){var o={};try{o=JSON.parse(n)}catch(e){}o.ns&&(r=o.ns)}!r&&t.parentElement&&e(t.parentElement)};l(t),r&&(o=r)}return o}function l(e){for(var t=window.location.search.substring(1),n=t.split("&"),o=0;o<n.length;o++){var i=n[o].split("=");if(i[0]==e)return i[1]}return!1}function s(e,t,n){var o=document.createElement("div");o.setAttribute("style",'z-index: 2001; font-family: "Helvetica", "Arial", sans-serif; position: fixed; bottom: 20px; right: 20px; padding: 10px; background-color: #fff; border: solid 1px #1976d2; box-shadow: 0px 1px 2px 0px rgba(0,0,0,0.5);'),o.setAttribute("ignorelocizeeditor",""),o.setAttribute("translated","");var i=document.createElement("h4");i.id="locize-title",i.innerHTML="locize editor",i.setAttribute("style",'font-family: "Helvetica", "Arial", sans-serif; font-size: 14px; margin: 0 0 5px 0; color: #1976d2; font-weight: 300;'),i.setAttribute("ignorelocizeeditor",""),o.appendChild(i);var r=document.createElement("button");r.innerHTML="On",r.setAttribute("style",c+" display: none; background-color: #54A229;"),r.onclick=t,r.setAttribute("ignorelocizeeditor",""),o.appendChild(r);var l=document.createElement("button");l.innerHTML="Off",l.setAttribute("style",c+" display: none; background-color: #D50000;"),l.onclick=e,l.setAttribute("ignorelocizeeditor",""),o.appendChild(l),document.body.appendChild(o);var s=function(e){r.style.display=e?"block":"none",l.style.display=e?"none":"block"};return s}function a(e,t){var n=document.createElement("div");n.setAttribute("style",t.iframeContainerStyle),n.setAttribute("ignorelocizeeditor",""),n.setAttribute("translated","");var o=document.createElement("iframe");o.setAttribute("style",t.iframeStyle),o.setAttribute("ignorelocizeeditor",""),o.setAttribute("translated",""),o.setAttribute("src",e),n.appendChild(o),document.body.appendChild(n);var i=document.body.getAttribute("style");return document.body.setAttribute("style",i+"; "+t.bodyStyle),o.contentWindow}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c='font-family: "Helvetica", "Arial", sans-serif; font-size: 14px; color: #fff; border: none; font-weight: 300; height: 30px; line-height: 30px; padding: 0; text-align: center; min-width: 90px; text-decoration: none; text-transform: uppercase; text-overflow: ellipsis; white-space: nowrap; outline: none; cursor: pointer;',p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},u={url:"https://www.locize.io",enabled:!1,enableByQS:"locize",toggleKeyCode:24,toggleKeyModifier:"ctrlKey",lngOverrideQS:"useLng",autoOpen:!0,mode:l("locizeMode")||"iframe",iframeContainerStyle:"z-index: 2000; position: fixed; top: 0; right: 0; bottom: 0; width: 500px; box-shadow: -3px 0 5px 0 rgba(0,0,0,0.5);",iframeStyle:"height: 100%; width: 500px; border: none;",bodyStyle:"margin-right: 505px;"},f={type:"3rdParty",init:function(e){var t=this;this.enabled=!1,this.i18next=e,this.options=p({},u,e.options.editor),this.locizeUrl=e.options.editor&&e.options.editor.url||"https://www.locize.io",this.handler=this.handler.bind(this),(this.options.enabled||this.options.enableByQS&&"true"===l(this.options.enableByQS))&&setTimeout(function(){t.toggleUI=s(t.on.bind(t),t.off.bind(t),t.options),t.options.autoOpen&&t.open(),t.on()},500),document.addEventListener("keypress",function(e){e[t.options.toggleKeyModifier]&&e.which===t.options.toggleKeyCode&&(t.enabled?t.off():t.on())}),window.addEventListener("message",function(e){e.data[t.options.toggleKeyModifier]&&e.data.which===t.options.toggleKeyCode&&(t.enabled?t.off():t.on())})},handler:function(e){var t=this;e.preventDefault();var n=o(e);if(n){var s=n.textContent||n.text.innerText,a=s.replace(/\n +/g,"").trim(),d=function(){var e={message:"searchForKey",projectId:t.i18next.options.backend.projectId,version:t.i18next.options.backend.version||"latest",lng:l(t.options.lngOverrideQS)||t.i18next.languages[0],ns:r(a,n,t.i18next),token:i(a,t.i18next)};return e.lng&&"cimode"!==e.lng.toLowerCase()||(e.lng=t.i18next.options.backend.referenceLng),t.options.handler?t.options.handler(e):(t.locizeInstance.postMessage(e,t.options.url),void t.locizeInstance.focus())};this.options.autoOpen&&("iframe"!==this.options.mode&&!this.locizeInstance||this.locizeInstance.closed)?(this.open(),setTimeout(function(){d()},3e3)):d()}},open:function(){return"iframe"===this.options.mode?this.locizeInstance=a(this.options.url,this.options):void(this.locizeInstance=window.open(this.options.url))},on:function(){document.body.addEventListener("click",this.handler),this.toggleUI(!0),this.enabled=!0},off:function(){document.body.removeEventListener("click",this.handler),this.toggleUI(!1),this.enabled=!1}};return f});
