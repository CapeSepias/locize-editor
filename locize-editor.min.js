!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.locizeEditor=e()}(this,function(){"use strict";function t(t){return null!=t&&t===t.window}function e(e){return t(e)?e:9===e.nodeType&&e.defaultView}function n(t){var n,o,i={top:0,left:0,right:0,bottom:0},r=t&&t.ownerDocument;n=r.documentElement,"undefined"!==a(t.getBoundingClientRect)&&(i=t.getBoundingClientRect()),o=e(r);var l=i.top+o.pageYOffset-n.clientTop,s=i.left+o.pageXOffset-n.clientLeft;return{top:l,left:s,right:s+(i.right-i.left),bottom:l+(i.bottom-i.top)}}function o(t){var e=void 0,o=void 0;if(t.originalEvent&&t.originalEvent.explicitOriginalTarget)e=t.originalEvent.explicitOriginalTarget;else{var i=t.srcElement;if(i.getAttribute&&""===i.getAttribute("ignorelocizeeditor"))return null;for(var r=t.pageX,l=t.pageY,s=(n(i),0),a=void 0,c=0;c<i.childNodes.length;c++){var d=i.childNodes[c],p=n(d);1===d.nodeType&&p.bottom<l&&(s=c+1),!a&&p.top+(d.clientHeight||0)>l&&(a=c)}s+1>i.childNodes.length&&(s=i.childNodes.length-1),a||(a=i.childNodes.length);for(var f=s;f<a;f++){var u=i.childNodes[f],h=n(u);if(!o&&h.left>r)break;8!==u.nodeType&&(e=u)}}return e}function i(t,e){var n=t,o=e.options.nsSeparator;if(t.indexOf(o)>-1){var i=t.split(o);i.shift(),n=i.join(o)}return n}function r(t,e,n){var o=n.options.defaultNS,i=n.options.nsSeparator;if(t.indexOf(i)>-1)o=t.split(i)[0];else{var r=void 0,l=function t(e){var n=e.getAttribute&&e.getAttribute("i18next-options");if(n){var o={};try{o=JSON.parse(n)}catch(t){}o.ns&&(r=o.ns)}!r&&e.parentElement&&t(e.parentElement)};l(e),r&&(o=r)}return o}function l(t){for(var e=window.location.search.substring(1),n=e.split("&"),o=0;o<n.length;o++){var i=n[o].split("=");if(i[0]==t)return i[1]}return!1}function s(t,e){var n=document.createElement("div");n.setAttribute("style",'z-index: 1000, font-family: "Helvetica", "Arial", sans-serif; position: fixed; bottom: 20px; right: 20px; padding: 10px; background-color: #fff; border: solid 1px #1976d2; box-shadow: 0px 1px 2px 0px rgba(0,0,0,0.5);'),n.setAttribute("ignorelocizeeditor",""),n.setAttribute("translated","");var o=document.createElement("h4");o.id="locize-title",o.innerHTML="locize editor",o.setAttribute("style",'font-family: "Helvetica", "Arial", sans-serif; font-size: 14px; margin: 0 0 5px 0; color: #1976d2; font-weight: 300;'),o.setAttribute("ignorelocizeeditor",""),n.appendChild(o);var i=document.createElement("button");i.innerHTML="On",i.setAttribute("style",c+" display: none; background-color: #54A229;"),i.onclick=e,i.setAttribute("ignorelocizeeditor",""),n.appendChild(i);var r=document.createElement("button");r.innerHTML="Off",r.setAttribute("style",c+" display: none; background-color: #D50000;"),r.onclick=t,r.setAttribute("ignorelocizeeditor",""),n.appendChild(r),document.body.appendChild(n);var l=function(t){i.style.display=t?"block":"none",r.style.display=t?"none":"block"};return l}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c='font-family: "Helvetica", "Arial", sans-serif; font-size: 14px; color: #fff; border: none; font-weight: 300; height: 30px; line-height: 30px; padding: 0; text-align: center; min-width: 90px; text-decoration: none; text-transform: uppercase; text-overflow: ellipsis; white-space: nowrap; outline: none; cursor: pointer;',d=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},p={url:"https://www.locize.io",enabled:!1,enableByQS:"locize",autoOpen:!0},f={type:"3rdParty",init:function(t){var e=this;this.i18next=t,this.options=d({},p,t.options.editor),this.locizeUrl=t.options.editor&&t.options.editor.url||"https://www.locize.io",this.handler=this.handler.bind(this),(this.options.enabled||this.options.enableByQS&&l(this.options.enableByQS))&&setTimeout(function(){e.toggleUI=s(e.on.bind(e),e.off.bind(e)),e.options.autoOpen&&e.open(),e.on()},500)},handler:function(t){var e=this,n=o(t);if(n){var l=n.textContent||n.text.innerText,s=l.replace(/\n +/g,"").trim(),a=function(){var t={message:"searchForKey",projectId:e.i18next.options.backend.projectId,version:e.i18next.options.backend.version||"latest",lng:e.i18next.languages[0],ns:r(s,n,e.i18next),token:i(s,e.i18next)};return e.options.handler?e.options.handler(t):(e.locizeInstance.postMessage(t,e.options.url),void e.locizeInstance.focus())};!this.options.autoOpen||this.locizeInstance&&!this.locizeInstance.closed?a():(this.open(),setTimeout(function(){a()},3e3))}},open:function(){this.locizeInstance=window.open(this.options.url)},on:function(){document.body.addEventListener("click",this.handler),this.toggleUI(!0)},off:function(){document.body.removeEventListener("click",this.handler),this.toggleUI(!1)}};return f});
